---
# - debug:
#     msg: "{{ lookup('env', 'PWD') }}"

- name: copy traefik config file to manifests
  become: true
  copy:
    src: ../files/traefik-config.yaml
    dest: /var/lib/rancher/k3s/server/manifests/traefik-config.yaml
    owner: root
    group: root
    mode: '0600'

- name: expose traefik
  shell:
    cmd: kubectl apply -f files/dashboard.yaml
    chdir: /mnt/f/_code/sheol-playbook/roles/base/traefik-dashboard
  delegate_to: 127.0.0.1
  register: kubectl_traefik

- name: Print k3d cluster list
  debug:
    var: kubectl_traefik.stdout
