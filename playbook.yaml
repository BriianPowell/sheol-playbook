- name: Install build deps and dotfiles
  hosts: k3s_cluster
  gather_facts: yes
  tags: [server, setup]
  roles:
    - build-deps
    - dotfiles

# - name: Setup k3d
#   hosts: master
#   gather_facts: yes
#   become: yes
#   tags: [server, k3d]
#   roles:
#     - k3d/download
#     - k3d/create

- name: Setup k3s
  hosts: k3s_cluster
  gather_facts: yes
  become: yes
  tags: [server, k3s]
  roles:
    - k3s/prereq
    - k3s/download

- name: k3s Master Node
  hosts: master
  become: yes
  roles:
    - k3s/master

# - name: k3s Agent Node
#   hosts: agent
#   become: yes
#   roles:
#     - k3s/node

- name: Begin Base
  hosts: master
  environment:
    KUBECONFIG: '{{ kubeconfig }}'
  roles:
    - base/traefik-dashboard
